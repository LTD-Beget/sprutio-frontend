// Generated by CoffeeScript 1.11.1
Ext.define('FM.action.NewFile', {
  extend: 'FM.overrides.Action',
  config: {
    scale: "large",
    iconAlign: "top",
    iconCls: "fm-action-newfile",
    text: t("New File"),
    handler: function(panel) {
      var promt, session;
      if (panel == null) {
        panel = FM.Active;
      }
      FM.Logger.info('Run Action FM.action.NewFile', arguments);
      session = Ext.ux.Util.clone(panel.session);
      promt = Ext.create('FM.view.windows.PromtWindow', {
        title: t("New File"),
        msg: t("Enter a name of file to create:"),
        fieldValue: "new_file.txt",
        ok: function(button, promt_window, field) {
          var name, path, record;
          FM.Logger.info('OK handler()', session, arguments);
          button.disable();
          name = field.getValue();
          if (panel.filelist.store.find("name", name, 0, false, false, true) > -1) {
            FM.helpers.ShowError(t("File with this name already exists in the current folder."));
            button.enable();
            return;
          }
          record = FM.model.File.create({
            name: name
          });
          path = FM.helpers.GetAbsName(session, record);
          if (session.type === FM.Session.LOCAL_APPLET) {
            try {
              return panel.applet.newfile(path, session, promt_window);
            } catch (error) {
              button.enable();
              FM.helpers.ShowError(t("Error during operation. <br/>Please contact Support."));
              return FM.Logger.error("Applet error");
            }
          } else {
            return FM.backend.ajaxSend('/actions/files/newfile', {
              params: {
                session: session,
                path: path
              },
              success: (function(_this) {
                return function(response) {
                  var item;
                  item = Ext.util.JSON.decode(response.responseText).data;
                  FM.getApplication().fireEvent(FM.Events.file.newFile, item, session);
                  return promt_window.close();
                };
              })(this),
              failure: (function(_this) {
                return function(response) {
                  button.enable();
                  FM.helpers.ShowError(t("Error during operation. <br/>Please contact Support."));
                  return FM.Logger.error(response);
                };
              })(this)
            });
          }
        }
      });
      return promt.show();
    }
  }
});
